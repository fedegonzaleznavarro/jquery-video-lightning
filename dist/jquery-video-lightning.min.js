/*
 *  jQuery Video Lightning - vpre2.1
 *  Turn any element into a lightbox or popover link for Youtube and Vimeo videos.
 *  https://github.com/musocrat/jquery-video-lightning
 *
 *  Made by Andrew Carpenter
 *  Under MIT License
 */
(function(){var a=function(a,b){return function(){return a.apply(b,arguments)}};!function(b,c,d){var e,f,g,h,i,j;return i="jqueryVideoLightning",g={id:"y-dQw4w9WgXcQ",width:"640px",height:"390px",autoplay:0,autohide:2,controls:1,iv_load_policy:1,loop:0,modestbranding:0,playlist:"",related:0,showinfo:1,start_time:0,theme:"dark",color:"",byline:1,portrait:1,effect_in:"fadeIn",ease_in:300,ease_out:0,z_index:21e3,backdrop_color:"#000",backdrop_opacity:1,glow:0,glow_color:"#fff",rick_roll:0,cover:0,popover:0,popover_x:"auto",popover_y:"auto",peek:0},e=function(){function e(c,d){this.destroy=a(this.destroy,this),this.vimeoPlayer=a(this.vimeoPlayer,this),this.youtubePlayer=a(this.youtubePlayer,this),this.coverImage=a(this.coverImage,this),this.fullHex=a(this.fullHex,this),this.prepHex=a(this.prepHex,this),this.colorConverter=a(this.colorConverter,this),this.popoverPosition=a(this.popoverPosition,this),this.popover=a(this.popover,this),this.getSettings=a(this.getSettings,this),this.player=a(this.player,this),this.init=a(this.init,this),this.element=c,this.target=b(this.element),this.target_wrapper=this.target.parent(".video-target").length>0?this.target.parent(".video-target"):this.target.wrap("<span class='video-target'></span>").parent(".video-target"),this.base_settings=b.extend({},g,d),this.settings=this.getSettings(),this.vendor="v"===this.settings.videoId.charAt(0).toLowerCase()?"vimeo":"youtube",this.video_id=this.settings.videoId.substring(2),this.init()}return e.prototype.init=function(){var a;return this.target_wrapper.css("cursor","pointer"),b("style:contains('.video-wrapper')").length<1&&(a="<style type='text/css'> .video-wrapper{ display: none; position: fixed; min-width: 100%; min-height: 100%; top: 0; bottom: 0; left: 0; z-index: "+this.settings.videoZIndex+"; } .video-frame{ background: #000000; } </style>",b(a).appendTo("head")),1===this.settings.videoCover&&this.coverImage(this.vendor,this.video_id,this.target_wrapper),this.target_wrapper.on("click",function(a){return function(){return a.player()}}(this)),1===this.settings.videoPeek&&(this.target_wrapper.on("mouseenter",function(a){return function(){return a.player()}}(this)),this.target_wrapper.on("mouseleave",function(a){return function(){return a.player()}}(this))),1===this.settings.videoPopover?(b(d).on("scroll mousewheel DOMMouseScroll MozMousePixelScroll",function(a){return function(){return a.popoverPosition()}}(this)),b(c).on("resize",function(a){return function(){return a.popoverPosition()}}(this))):void 0},e.prototype.player=function(){var a,b,c;return this.target_wrapper.find(".video-frame").is(":visible")||this.target_wrapper.find(".video-wrapper").is(":visible")?(1!==this.settings.videoRickRoll&&this.destroy(),void 0):(1===this.settings.videoPopover?(a='<div class="video-frame"><div class="video"></div></div>',this.target_wrapper.append(a),this.video_frame=this.target_wrapper.find(".video-frame"),c=this.video_frame,this.video_frame.css({position:"fixed"}),this.popover()):(a='<div class="video-wrapper"><div class="video-frame"><div class="video"></div></div></div>',this.target_wrapper.append(a),b=this.colorConverter(this.settings.videoBackdropColor),this.video_frame=this.target_wrapper.find(".video-frame"),c=this.target_wrapper.find(".video-wrapper"),c.css({backgroundColor:"rgba("+b.red+","+b.blue+","+b.green+","+this.settings.videoBackdropOpacity+")"}),this.video_frame.css({position:"absolute",top:this.settings.videoFrameTop,left:this.settings.videoFrameLeft})),this.video_frame.css({width:""+this.settings.videoWidth+"px",height:""+this.settings.videoHeight+"px",marginTop:this.settings.videoFrameMarginTop,marginLeft:this.settings.videoFrameMarginLeft,boxShadow:"0px 0px "+this.settings.videoGlow+"px "+this.settings.videoGlow/5+"px "+this.fullHex(this.settings.videoGlowColor)}),c[this.settings.videoEffectIn](this.settings.videoEaseIn),this.target_wrapper.find(".video").append(this[""+this.vendor+"Player"]()))},e.prototype.getSettings=function(){var a,d,e;return d=function(a){return b.each(a,function(a){return function(c,d){var e;return e="video"+c.toLowerCase().charAt(0).toUpperCase()+c.slice(1).replace(/_([a-z])/g,function(a,b){return b.toUpperCase()}),b(a).data(e,d)}}(this)),b(this).data()},e=this.base_settings,e=this.target.extend({},d(e),this.target.data()),e.videoWidth=parseInt(e.videoWidth,10),e.videoHeight=parseInt(e.videoHeight,10),a=e.videoHeight/e.videoWidth,e.videoWidth>b(c).width()-30&&(e.videoWidth=b(c).width()-30,e.videoHeight=Math.round(a*e.videoWidth)),e.videoFrameTop="50%",e.videoFrameLeft="50%",e.videoFrameMarginTop="-"+e.videoHeight/2+"px",e.videoFrameMarginLeft="-"+e.videoWidth/2+"px",e},e.prototype.popover=function(){return this.settings.videoFrameMarginTop=0,this.settings.videoFrameMarginLeft=0,this.popoverPosition()},e.prototype.popoverPosition=function(){var a,b,c,d,e,g;if(this.video_frame)return d=j(),b=f(this.element),c=h(b,this.settings.videoHeight,this.settings.videoWidth),c.x&&c.y||(a=!0),g=a?d.height/2-this.settings.videoHeight/2:c.y,e=a?d.width/2-this.settings.videoWidth/2:c.x,this.settings.videoFrameTop=""+g+"px",this.settings.videoFrameLeft=""+e+"px",this.video_frame.animate({top:this.settings.videoFrameTop,left:this.settings.videoFrameLeft},{duration:100,easing:"linear",queue:!1})},e.prototype.colorConverter=function(a){var b,c,d;return d=parseInt(this.prepHex(a).substring(0,2),16),b=parseInt(this.prepHex(a).substring(2,4),16),c=parseInt(this.prepHex(a).substring(4,6),16),{red:d,blue:b,green:c}},e.prototype.prepHex=function(a){return a="#"===a.charAt(0)?a.split("#")[1]:a,3===a.length&&(a+=a),a},e.prototype.fullHex=function(a){return a="#"+this.prepHex(a)},e.prototype.coverImage=function(a,c,d){var e,f;return this.target_wrapper=d,e="http://www.vimeo.com/api/v2/video/"+c+".json?callback=?",f="http://img.youtube.com/vi/"+c+"/hqdefault.jpg","youtube"===a?b("<img class='video-cover'>").attr("src",f).appendTo(this.target_wrapper):b.getJSON(e,{format:"jsonp"}).done(function(a){return b("<img class='video-cover'>").attr("src",a[0].thumbnail_large).appendTo(this.target_wrapper)})},e.prototype.youtubePlayer=function(){var a,c;return a="width='"+this.settings.videoWidth+"' height='"+this.settings.videoHeight+"' frameborder='0' allowfullscreen",c="https://www.youtube.com/embed/"+this.video_id+"?"+("autoplay="+this.settings.videoAutoplay+"&")+("autohide="+this.settings.videoAutohide+"&")+("controls="+this.settings.videoControls+"&")+("iv_load_policy="+this.settings.videoIvLoadPolicy+"&")+("loop="+this.settings.videoLoop+"&")+("modestbranding="+this.settings.videoModestbranding+"&")+("playlist="+this.settings.videoPlaylist+"&")+("rel="+this.settings.videoRelated+"&")+("showinfo="+this.settings.videoShowinfo+"&")+("start="+this.settings.videoStartTime+"&")+("theme="+this.settings.videoTheme+"&")+("color="+this.prepHex(this.settings.videoColor)),b("<iframe src='"+c+"' "+a+"></iframe>")},e.prototype.vimeoPlayer=function(){var a,c;return a="width='"+this.settings.videoWidth+"' height='"+this.settings.videoHeight+"' frameborder='0' allowfullscreen",c="http://player.vimeo.com/video/"+this.video_id+"?"+("autoplay="+this.settings.videoAutoplay+"&")+("loop="+this.settings.videoLoop+"&title="+this.settings.videoShowinfo+"&")+("byline="+this.settings.videoByline+"&")+("portrait="+this.settings.videoPortrait+"&")+("color="+this.prepHex(this.settings.videoColor)),b("<iframe src='"+c+"' "+a+"></iframe>")},e.prototype.destroy=function(){return this.target_wrapper.find(".video-wrapper").hide(this.getSettings().videoEaseOut),setTimeout(function(a){return function(){return a.target_wrapper.find(".video").remove(),a.target_wrapper.find(".video-frame").remove(),a.target_wrapper.find(".video-wrapper").remove(),b(a).off(),b(a).removeData()}}(this),this.getSettings().videoEaseOut)},e}(),j=function(){var a;return(a=d.getElementById("jqvl-size-test"))||(a=d.createElement("div"),a.id="jqvl-size-test",a.style.cssText="position:fixed;top:0;left:0;bottom:0;right:0;visibility:hidden;",d.body.appendChild(a)),{height:a.offsetHeight,width:a.offsetWidth}},f=function(a){var b,c;return c=a.getBoundingClientRect(),b=0,{top:c.top-b,right:c.right+b,bottom:c.bottom+b,left:c.left-b,width:c.width||c.right-c.left,height:c.height||c.bottom-c.top}},h=function(a,b,c){var d,e,f,g,h,i,k,l,m,n,o,p,q,r;for(e={x:(g=j().width)/2,y:(f=j().height)/2},d={x:c/2,y:b/2},h=[],k=m=o=a.left,p=a.right+c;p>=m;k=m+=30)h.push([k-c,a.top-b]),h.push([k-c,a.bottom]);for(l=n=q=a.top,r=a.bottom+b;r>=n;l=n+=30)h.push([a.left-c,l-b]),h.push([a.right,l-b]);return i=function(a,h){var i,j,m,n,o,p,q,r;for(r=[[a,n={}],[h,o={}]],p=0,q=r.length;q>p;p++)i=r[p],k=i[0][0],l=i[0][1],i[1].diffx=(j=k+d.x)>e.x?j-e.x:e.x-j,i[1].diffy=(m=l+d.y)>e.y?m-e.y:e.y-m,i[1].diff=i[1].diffx+i[1].diffy,(0>k||k+c>g)&&(i[1].diff=1e4),(0>l||l+b>f)&&(i[1].diff=1e4);return n.diff-o.diff},h.sort(i),{x:(k=h[0][0])<0||k+c>g?null:k,y:(l=h[0][1])<0||l+b>f?null:l}},b.fn[i]=function(a){return this.each(function(){b.data(this,"plugin_"+i)||b.data(this,"plugin_"+i,new e(this,a))})},this}(jQuery,window,document)}).call(this);